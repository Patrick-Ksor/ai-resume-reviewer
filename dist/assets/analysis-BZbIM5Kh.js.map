{"version":3,"file":"analysis-BZbIM5Kh.js","sources":["../../src/services/analysisService.ts","../../src/stores/analysis.ts"],"sourcesContent":["import api from './api'\r\nimport type { ApiResponse, PaginatedResponse } from '@/types/api'\r\nimport type { Analysis, HistoryFilters } from '@/types/analysis'\r\n\r\nexport const analysisService = {\r\n  async submitAnalysis(\r\n    file: File,\r\n    portfolioUrl: string,\r\n    jobDescription: string,\r\n    onUploadProgress?: (percent: number) => void,\r\n  ): Promise<Analysis> {\r\n    const formData = new FormData()\r\n    formData.append('resume', file)\r\n    formData.append('portfolioUrl', portfolioUrl)\r\n    formData.append('jobDescription', jobDescription)\r\n\r\n    const { data } = await api.post<ApiResponse<Analysis>>('/analyses', formData, {\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n      onUploadProgress: (event) => {\r\n        if (event.total) {\r\n          const percent = Math.round((event.loaded * 100) / event.total)\r\n          onUploadProgress?.(percent)\r\n        }\r\n      },\r\n    })\r\n    return data.data\r\n  },\r\n\r\n  async getAnalysis(id: string): Promise<Analysis> {\r\n    const { data } = await api.get<ApiResponse<Analysis>>(`/analyses/${id}`)\r\n    return data.data\r\n  },\r\n\r\n  async getHistory(filters?: HistoryFilters): Promise<PaginatedResponse<Analysis>> {\r\n    const params = new URLSearchParams()\r\n    if (filters?.page) params.set('page', String(filters.page))\r\n    if (filters?.limit) params.set('limit', String(filters.limit))\r\n    if (filters?.search) params.set('search', filters.search)\r\n    if (filters?.status) params.set('status', filters.status)\r\n\r\n    const { data } = await api.get<PaginatedResponse<Analysis>>('/analyses', { params })\r\n    return data\r\n  },\r\n\r\n  async downloadReport(id: string): Promise<Blob> {\r\n    const { data } = await api.get(`/analyses/${id}/download`, {\r\n      responseType: 'blob',\r\n    })\r\n    return data as Blob\r\n  },\r\n\r\n  async deleteAnalysis(id: string): Promise<void> {\r\n    await api.delete(`/analyses/${id}`)\r\n  },\r\n}\r\n","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { analysisService } from '@/services/analysisService'\r\nimport type { Analysis, HistoryFilters } from '@/types/analysis'\r\n\r\nexport const useAnalysisStore = defineStore('analysis', () => {\r\n  // ── State ─────────────────────────────────────────────────────────────\r\n  const current = ref<Analysis | null>(null)\r\n  const history = ref<Analysis[]>([])\r\n  const historyTotal = ref(0)\r\n  const historyPage = ref(1)\r\n  const historyTotalPages = ref(1)\r\n\r\n  const uploading = ref(false)\r\n  const uploadProgress = ref(0)\r\n  const loadingCurrent = ref(false)\r\n  const loadingHistory = ref(false)\r\n  const error = ref<string | null>(null)\r\n\r\n  // ── Getters ──────────────────────────────────────────────────────────\r\n  const hasResults = computed(\r\n    () => !!current.value && current.value.status === 'completed',\r\n  )\r\n  const latestAtsScore = computed(\r\n    () => current.value?.atsScore?.overall ?? history.value[0]?.atsScore?.overall ?? null,\r\n  )\r\n  const totalAnalyses = computed(() => historyTotal.value)\r\n\r\n  // ── Actions ───────────────────────────────────────────────────────────\r\n  async function submitAnalysis(file: File, portfolioUrl: string, jobDescription: string) {\r\n    uploading.value = true\r\n    uploadProgress.value = 0\r\n    error.value = null\r\n    try {\r\n      const result = await analysisService.submitAnalysis(\r\n        file,\r\n        portfolioUrl,\r\n        jobDescription,\r\n        (pct) => { uploadProgress.value = pct },\r\n      )\r\n      current.value = result\r\n      return result\r\n    } catch (e) {\r\n      error.value = (e as { message: string }).message ?? 'Submission failed'\r\n      throw e\r\n    } finally {\r\n      uploading.value = false\r\n    }\r\n  }\r\n\r\n  async function fetchAnalysis(id: string) {\r\n    loadingCurrent.value = true\r\n    error.value = null\r\n    try {\r\n      current.value = await analysisService.getAnalysis(id)\r\n    } catch (e) {\r\n      error.value = (e as { message: string }).message ?? 'Failed to load analysis'\r\n      throw e\r\n    } finally {\r\n      loadingCurrent.value = false\r\n    }\r\n  }\r\n\r\n  async function fetchHistory(filters?: HistoryFilters) {\r\n    loadingHistory.value = true\r\n    error.value = null\r\n    try {\r\n      const res = await analysisService.getHistory(filters)\r\n      history.value = res.data\r\n      historyTotal.value = res.total\r\n      historyPage.value = res.page\r\n      historyTotalPages.value = res.totalPages\r\n    } catch (e) {\r\n      error.value = (e as { message: string }).message ?? 'Failed to load history'\r\n    } finally {\r\n      loadingHistory.value = false\r\n    }\r\n  }\r\n\r\n  async function downloadReport(id: string, filename = 'resume-report.pdf') {\r\n    const blob = await analysisService.downloadReport(id)\r\n    const url = URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    a.href = url\r\n    a.download = filename\r\n    a.click()\r\n    URL.revokeObjectURL(url)\r\n  }\r\n\r\n  function clearCurrent() {\r\n    current.value = null\r\n    uploadProgress.value = 0\r\n    error.value = null\r\n  }\r\n\r\n  return {\r\n    current,\r\n    history,\r\n    historyTotal,\r\n    historyPage,\r\n    historyTotalPages,\r\n    uploading,\r\n    uploadProgress,\r\n    loadingCurrent,\r\n    loadingHistory,\r\n    error,\r\n    hasResults,\r\n    latestAtsScore,\r\n    totalAnalyses,\r\n    submitAnalysis,\r\n    fetchAnalysis,\r\n    fetchHistory,\r\n    downloadReport,\r\n    clearCurrent,\r\n  }\r\n})\r\n"],"names":["analysisService","file","portfolioUrl","jobDescription","onUploadProgress","formData","data","api","event","percent","id","filters","params","useAnalysisStore","defineStore","current","ref","history","historyTotal","historyPage","historyTotalPages","uploading","uploadProgress","loadingCurrent","loadingHistory","error","hasResults","computed","latestAtsScore","totalAnalyses","submitAnalysis","result","pct","e","fetchAnalysis","fetchHistory","res","downloadReport","filename","blob","url","a","clearCurrent"],"mappings":"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"}